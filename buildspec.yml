version: 0.2


phases:
  install:
    commands:
      - export NGINX_IMAGE_REPOSITORY=rapidfort/nginx
      - export NGINX_IMAGE_TAG=latest
      - export RF_ACCESS_TOKEN=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

  build:
    commands:
      - echo "Listing files in the repository"
      - ls -R
      - echo "Navigating to the Docker Compose directory"
      - cd community_images/nginx/bitnami
      - ls -R
      - echo "Building Docker image using Docker Compose"
      - docker-compose up -d
      - docker image ls
      - aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin 550843840101.dkr.ecr.us-east-1.amazonaws.com
      - docker tag rapidfort/nginx:latest 550843840101.dkr.ecr.us-east-1.amazonaws.com/rapidfort/nginx:latest
      - docker push rapidfort/nginx  
